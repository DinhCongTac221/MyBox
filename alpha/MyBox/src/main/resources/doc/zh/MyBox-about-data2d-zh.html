<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
        <title>二维存储结构的数据</title>
    </head>
    <body style="width: 900px; margin:0 auto;" contenteditable="false">
        <h1 align="center">二维存储结构的数据</h1>
        <h2>1. 数据对象</h2>
        <ol>
            <li><p style="margin-bottom: 0cm"><a name="editData11"></a>以下对象可以以一致的方式来编辑<span lang="zh-CN">和计算</span>：</p></li>
        </ol>
        <ul>
            <ul>
                <ul>
                    <li><p style="margin-bottom: 0cm">数据文件<span lang="zh-CN">，包括</span><font face="Times New Roman, serif"><span lang="en-US">CSV</span></font><span lang="zh-CN">文件、</span><font face="Times New Roman, serif"><span lang="en-US">Excel</span></font><span lang="zh-CN">文件、</span>文本<span lang="zh-CN">文件</span></p></li>
                    <li><p style="margin-bottom: 0cm"><font face="Times New Roman, serif"><span lang="en-US">MyBox</span></font>粘贴板<span lang="zh-CN">的数据</span></p></li>
                    <li><p style="margin-bottom: 0cm">矩阵</p></li>
                    <li><p style="margin-bottom: 0cm">数据库表</p></li>
                </ul>
            </ul>
        </ul>
        <ol start="2">
            <li><p style="margin-bottom: 0cm">数据被表示为二维存储结构<span lang="zh-CN">：</span></p></li>
        </ol>
        <ul>
            <ul>
                <ul>
                    <li><p style="margin-bottom: 0cm">“列”定义数据的属性<font face="Times New Roman, serif"><span lang="en-US">/</span></font>字段<font face="Times New Roman, serif"><span lang="en-US">, </span></font>横向延展数据的维度。</p></li>
                    <li><p style="margin-bottom: 0cm">“行”保存数据的实例，纵向延展数据的集合。</p></li>
                    <li><p>数据应当等宽<span lang="zh-CN">，</span>即所有行的列数都相同。</p></li>
                </ul>
            </ul>
        </ul>
        <h2>2. 定义数据列</h2>
        <h3>2.1 数据列的管理界面</h3>
        <p style="margin-bottom: 0cm"><font face="Times New Roman, serif"><span lang="en-US"> </span></font>在数据处理的“列”页签下，在表格中增<font face="Times New Roman, serif"><span lang="en-US">/</span></font>删<font face="Times New Roman, serif"><span lang="en-US">/</span></font>改数据的列：</p>
        <ol>
            <li><p style="margin-bottom: 0cm">列名不能为空也不能重复。</p></li>
            <li><p style="margin-bottom: 0cm">直接点击表格单元以编辑</p></li>
            <li><p style="margin-bottom: 0cm">也可以选择列并点击“编辑”按钮以弹出列的编辑窗。</p></li>
            <li><p style="margin-bottom: 0cm">可以重命名所有字段为序列号。</p></li>
            <li><p style="margin-bottom: 0cm">可以随机设置颜色。</p></li>
            <li><p style="margin-bottom: 0cm">可以调整列的顺序。</p></li>
            <li><p style="margin-bottom: 0cm">点击按钮“确定”以把<span lang="zh-CN">列的</span>修改应用于当前<span lang="zh-CN">数据</span>。</p></li>
            <li><p style="margin-bottom: 0cm">点击按钮“取消”以丢弃修改并从当前数据读取列的定义。</p></li>
            <li><p style="margin-bottom: 0cm">修改未保存时，若修改未应用于数据，则页签头显示<font face="Times New Roman, serif"><span lang="en-US">**</span></font>，否则页签头显示<font face="Times New Roman, serif"><span lang="en-US">*</span></font>。</p></li>
        </ol>
        <h3>2.2 列的类型</h3>
        <ol>
            <li value="1"><p>列的类型包括：字串、双精度、浮点、长整型、整型、短整型、布尔型、日期时间、日期、纪元、经度、纬度、枚举型、色彩。</p></li>
            <li><p>此属性用于数据的显示、编辑、计算、和保存。</p></li>
            <li><p style="margin-bottom: 0cm">通常应成对定义经度和纬度。</p></li>
        </ol>
        <h3>2.3 列的格式</h3>
        <ol>
            <li><p>此属性主要用于显示，在编辑输入数值时不会自动应用格式、而是保持原始的输入。</p></li>
            <li><p>在一些界面上，如“复制”或“导出”，可选“按照列的格式保存日期<font face="Times New Roman, serif"><span lang="en-US">/</span></font>时间<font face="Times New Roman, serif"><span lang="en-US">/</span></font>纪元和数字”。</p> <p></p></li>
        </ol>
        <h4>2.3.1 数字的格式</h4>
        <p style="margin-bottom: 0cm"><font face="Times New Roman, serif"><span lang="en-US"> </span></font>对于数字类型，可选：以千分组、以万分组、科学计数法、无格式。</p>
        <h4>2.3.2 日期时间<font face="Arial, sans-serif"><span lang="en-US">/</span></font>日期的格式</h4>
        <p style="margin-bottom: 0cm"><font face="Times New Roman, serif"><span lang="en-US"> </span></font>对于日期时间<font face="Times New Roman, serif"><span lang="en-US">/</span></font>日期类型，支持：<font face="Times New Roman, serif"><span lang="en-US">MM/dd/yy</span></font>、<font face="Times New Roman, serif"><span lang="en-US">yy-MM-dd</span></font>、毫秒、时区、<font face="Times New Roman, serif"><span lang="en-US">T</span></font>分隔、补全世纪。</p>
        <h4>2.3.3 纪元的格式</h4>
        <p style="margin-bottom: 0cm"><font face="Times New Roman, serif"><span lang="en-US"> </span></font>对于纪元类型，支持：<font face="Times New Roman, serif"><span lang="en-US">M/d/y</span></font>、<font face="Times New Roman, serif"><span lang="en-US">y-M-d</span></font>、毫秒、时区、<font face="Times New Roman, serif"><span lang="en-US">T</span></font>分隔、补全世纪、中文前后缀（“公元”、“公元前”）、英文前后缀（“<font face="Times New Roman, serif"><span lang="en-US">AD”</span></font>、“<font face="Times New Roman, serif"><span lang="en-US">BC”</span></font>）。</p>
        <h4>2.3.4 定义枚举型</h4>
        <p style="margin-bottom: 0cm"><font face="Times New Roman, serif"><span lang="en-US"> </span></font>对于枚举型，可定义数值列表。</p>
        <h3>2.4 对于非法值的处理</h3>
        <ol>
            <li><p>数据列对于非法值的处理策略：略过、计为空值、计为零。</p></li>
            <li><p>在一些上下文环境中，“计为空值”等同于“略过”。</p></li>
            <li><p style="margin-bottom: 0cm">此属性只用于显示或者计算，在编辑输入数值时不会自动处理非法值。</p></li>
        </ol>
        <h2>3. 列的应用</h2>
        <p><font face="Times New Roman, serif"><span lang="en-US"> </span></font>列的应用原则为：“最大包容、最少处理”。</p>
        <h3>3.1 加载数据</h3>
        <p><font face="Times New Roman, serif"><span lang="en-US"> </span></font>加载数据时，不检查列类型，原样读取和导入。</p>
        <h3>3.2 显示数据</h3>
        <ol>
            <li><p>按列类型解析数值</p></li>
            <li><p>按列的定义来处理非法值</p></li>
            <li><p>按列的格式来重写数值</p></li>
            <li><p>被显示的数值，可能与当前实际数值并不相同。</p></li>
            <li><p>例如，列的类型为双精度，读入数值“<font face="Times New Roman, serif"><span lang="en-US">abc”</span></font>：</p></li>
        </ol>
        <ul>
            <ul>
                <li><p>若非法值计为零，则显示为零（实际值仍为“<font face="Times New Roman, serif"><span lang="en-US">abc”</span></font>）</p></li>
                <li><p style="margin-bottom: 0cm">若非法值略过或计为空，则显示为“<font face="Times New Roman, serif"><span lang="en-US">abc”</span></font>。</p></li>
            </ul>
        </ul>
        <h3>3.3 编辑控件</h3>
        <ol>
            <li><p>对于布尔类型，显示选择框。</p></li>
            <li><p>对于枚举类型，显示下拉选择列表。</p></li>
            <li><p>对于颜色类型，显示调色盘。</p></li>
            <li><p style="margin-bottom: 0cm">对于经度<font face="Times New Roman, serif"><span lang="en-US">/</span></font>纬度，可在地图上选择位置。</p></li>
        </ol>
        <h3>3.4 编辑数据单元</h3>
        <ol>
            <li><p>点击可编辑的数据单元，开始编辑。</p></li>
            <li><p>开始编辑时，数值原样显示，忽略列类型和列格式。</p></li>
            <li><p>在输入和修改数值过程中，按列类型检查输入框中的数值。</p></li>
        </ol>
        <ul>
            <ul>
                <li><p>若数值非法，则编辑框显示为异常颜色。</p></li>
                <li><p>若数值合法，则编辑框显示为正常颜色。</p></li>
                <li><p>数值始终保持用户的输入。</p></li>
            </ul>
        </ul>
        <ol start="4">
            <li><p>按回车键以提交修改，按ESC键以取消修改。</p></li>
            <li><p>选项：当焦点离开数据单元（点击其它控件）时，自动提交修改。</p></li>
            <li><p>当修改被提交后，检查编辑框中的数值：</p></li>
        </ol>
        <ul>
            <ul>
                <li><p>若数值未变化，则不检查类型也不提交保存。</p></li>
                <li><p>若数值有变化，则按列类型检查修改后的数值：</p>
                    <ul>
                        <li><p>对非法值，拒绝保存，恢复数值、原样显示。</p></li>
                        <li><p>对合法值，提交保存，然后按列类型和列格式显示保存后的数值。</p></li>
                    </ul></li>
            </ul>
        </ul>
        <ol start="7">
            <li><p>例如，列的类型为双精度，非法值计为空，小数位数为<font face="Times New Roman, serif"><span lang="en-US">2</span></font>。读入数值“<font face="Times New Roman, serif"><span lang="en-US">abc”</span></font>：</p></li>
        </ol>
        <ul>
            <ul>
                <li><p>数据单元显示为“<font face="Times New Roman, serif"><span lang="en-US">abc”</span></font>。</p></li>
                <li><p>用户修改它的数值为“<font face="Times New Roman, serif"><span lang="en-US">abc123”</span></font>：</p>
                    <ul>
                        <li><p>在用户输入过程中，输入框始终显示为异常颜色。</p></li>
                        <li><p>用户敲击回车或点击其它控件时，此数据单元恢复显示为“<font face="Times New Roman, serif"><span lang="en-US">abc”</span></font>并为正常颜色。</p></li>
                    </ul></li>
                <li><p>用户修改数值为“<font face="Times New Roman, serif"><span lang="en-US">123.4567”</span></font>：</p>
                    <ul>
                        <li><p>在用户输入过程中，输入框始终显示为正常颜色。</p></li>
                        <li><p>用户敲击回车或点击其它控件时，此数据单元被保存为“<font face="Times New Roman, serif"><span lang="en-US">123.4567”</span></font>、并显示为“<font face="Times New Roman, serif"><span lang="en-US">123.46”</span></font>。</p></li>
                    </ul></li>
            </ul>
        </ul>
        <ol start="8">
            <li><p>其它数据单元不受影响。即只要不修改数据单元，它们就一直保持原样。</p></li>
        </ol>
        <h3>3.5 检验数据值</h3>
        <ol>
            <li value="1"><p>检验的对象是当前页中的数据行。</p></li>
            <li><p>开启方式：</p></li>
        </ol>
        <ul>
            <ul>
                <li><p>点击按钮“检验当前页的数据”。</p></li>
                <li><p>选项：在保存时自动检验数据值。</p></li>
            </ul>
        </ul>
        <ol start="3">
            <li><p>以下内容被检验：</p></li>
        </ol>
        <ul>
            <ul>
                <li><p>若列被定义为非空，则此列的空值为非法。</p></li>
                <li><p>若数值不符合列的类型，则为非法。</p></li>
            </ul>
        </ul>
        <ol start="4">
            <li><p>检验结果被显示为<font face="Times New Roman, serif"><span lang="en-US">html</span></font>表格。</p></li>
        </ol>
        <h3>3.6 保存数据</h3>
        <ol>
            <li value="1"><p><font face="Times New Roman, serif"><span lang="en-US">CSV/</span></font>文本<font face="Times New Roman, serif"><span lang="en-US">/Excel</span></font>文件的数值都按字符串写入。</p></li>
            <li><p>数据库表的数值按“就近类型”写入：</p> <p style="margin-bottom: 0cm"></p></li>
        </ol>
        <dl>
            <dl>
                <dl>
                    <dl>
                        <dd>
                            <table width="322" border="1" bordercolor="#000000" cellpadding="4" cellspacing="0">
                                <colgroup>
                                    <col width="146">
                                    <col width="158">
                                </colgroup>
                                <tbody>
                                    <tr valign="TOP">
                                        <td width="146"><p align="CENTER"><font face="Times New Roman, serif"><span lang="en-US"><b>MyBox</b></span></font><b><span lang="zh-CN">的列类型</span></b></p></td>
                                        <td width="158"><p align="CENTER"><font face="Times New Roman, serif"><span lang="en-US"><b>JDBC</b></span></font><b>的数据类型</b></p></td>
                                    </tr>
                                    <tr valign="TOP">
                                        <td width="146"><p>字串<font face="Times New Roman, serif"><span lang="en-US">(String)</span></font></p></td>
                                        <td width="158"><p><font face="Times New Roman, serif"><span lang="en-US">VARCHAR</span></font></p></td>
                                    </tr>
                                    <tr valign="TOP">
                                        <td width="146"><p>双精度<font face="Times New Roman, serif"><span lang="en-US">(Double)</span></font></p></td>
                                        <td width="158"><p><font face="Times New Roman, serif"><span lang="en-US">DOUBLE</span></font></p></td>
                                    </tr>
                                    <tr valign="TOP">
                                        <td width="146"><p>浮点<font face="Times New Roman, serif"><span lang="en-US">(Float)</span></font></p></td>
                                        <td width="158"><p><font face="Times New Roman, serif"><span lang="en-US">FLOAT</span></font></p></td>
                                    </tr>
                                    <tr valign="TOP">
                                        <td width="146"><p>长整型<font face="Times New Roman, serif"><span lang="en-US">(Long)</span></font></p></td>
                                        <td width="158"><p><font face="Times New Roman, serif"><span lang="en-US">BIGINT</span></font></p></td>
                                    </tr>
                                    <tr valign="TOP">
                                        <td width="146"><p>整型<font face="Times New Roman, serif"><span lang="en-US">(Integer)</span></font></p></td>
                                        <td width="158"><p><font face="Times New Roman, serif"><span lang="en-US">INT</span></font></p></td>
                                    </tr>
                                    <tr valign="TOP">
                                        <td width="146"><p>短整型<font face="Times New Roman, serif"><span lang="en-US">(Short)</span></font></p></td>
                                        <td width="158"><p><font face="Times New Roman, serif"><span lang="en-US">SMALLINT</span></font></p></td>
                                    </tr>
                                    <tr valign="TOP">
                                        <td width="146"><p>布尔型<font face="Times New Roman, serif"><span lang="en-US">(Boolean)</span></font></p></td>
                                        <td width="158"><p><font face="Times New Roman, serif"><span lang="en-US">BOOLEAN</span></font></p></td>
                                    </tr>
                                    <tr valign="TOP">
                                        <td width="146"><p>日期<span lang="zh-CN">时间</span><font face="Times New Roman, serif"><span lang="en-US">(Datetime)</span></font></p></td>
                                        <td width="158"><p><font face="Times New Roman, serif"><span lang="en-US">TIMESTAMP</span></font></p></td>
                                    </tr>
                                    <tr valign="TOP">
                                        <td width="146"><p><span lang="zh-CN">日期</span><font face="Times New Roman, serif"><span lang="en-US">(Date)</span></font></p></td>
                                        <td width="158"><p><font face="Times New Roman, serif"><span lang="en-US">DATE</span></font></p></td>
                                    </tr>
                                    <tr valign="TOP">
                                        <td width="146"><p>纪元<font face="Times New Roman, serif"><span lang="en-US">(Era)</span></font></p></td>
                                        <td width="158"><p><font face="Times New Roman, serif"><span lang="en-US">BIGINT</span></font></p></td>
                                    </tr>
                                    <tr valign="TOP">
                                        <td width="146"><p>经度<font face="Times New Roman, serif"><span lang="en-US">(Longitude)</span></font></p></td>
                                        <td width="158"><p><font face="Times New Roman, serif"><span lang="en-US">DOUBLE</span></font></p></td>
                                    </tr>
                                    <tr valign="TOP">
                                        <td width="146"><p>纬度<font face="Times New Roman, serif"><span lang="en-US">(Latitude)</span></font></p></td>
                                        <td width="158"><p><font face="Times New Roman, serif"><span lang="en-US">DOUBLE</span></font></p></td>
                                    </tr>
                                    <tr valign="TOP">
                                        <td width="146"><p>枚举型<font face="Times New Roman, serif"><span lang="en-US">(Enumeration)</span></font></p></td>
                                        <td width="158"><p><font face="Times New Roman, serif"><span lang="en-US">VARCHAR</span></font></p></td>
                                    </tr>
                                    <tr valign="TOP">
                                        <td width="146"><p>颜色<font face="Times New Roman, serif"><span lang="en-US">(Color)</span></font></p></td>
                                        <td width="158"><p><font face="Times New Roman, serif"><span lang="en-US">VARCHAR</span></font></p></td>
                                    </tr>
                                </tbody>
                            </table>
                        </dd>
                    </dl>
                </dl>
            </dl>
        </dl>
        <p><font face="Times New Roman, serif"><span lang="en-US"> </span></font>注： <font face="Times New Roman, serif"><span lang="en-US">derby</span></font>不支持负数的时间类型，所以只能用长整型保存纪元。</p>
        <ol start="3">
            <li><p>矩阵的所有数值都按双精度写入。</p></li>
        </ol>
        <h3>3.7 计算数据</h3>
        <ol>
            <li><p>忽略列类型和列格式，用数据原值来处理，</p></li>
            <li><p>按计算的要求解析数值。例如计算需要双精度数字，则试图将数值转换为双精度。</p></li>
            <li><p>若数值转换失败，则按列的定义处理非法值。</p></li>
            <li><p>计算本身也可以定义对非法值的处理策略。计算的定义优先于列的定义。</p></li>
            <li><p>列和计算都可以定义小数位数。计算的定义优先于列的定义。</p></li>
            <li><p>例如，列类型为字串，对它进行描述性统计：</p></li>
        </ol>
        <ul>
            <ul>
                <li><p>每个数值被试图转换为双精度</p></li>
                <li><p>若非法值计为零，则非法值也被算在“个数”里，同时参与平均值和总和的计算。</p></li>
                <li><p>若略过非法值，则非法值不参与任何计算。</p></li>
                <li><p>若非法值计为空，则非法值导致所有计算的结果都非法（<font face="Times New Roman, serif"><span lang="en-US">Double.NaN</span></font>）。</p></li>
            </ul>
        </ul>
        <h3>3.8 数据排序</h3>
        <ol>
            <li><p>所有涉及到排序的计算，数据都会转换为临时数据库表，然后利用数据库系统来排序。</p></li>
            <li><p>排序结果与列的类型有关。例如，字串“<font face="Times New Roman, serif"><span lang="en-US">123”</span></font>小于字串“<font face="Times New Roman, serif"><span lang="en-US">18”</span></font>，而数字“<font face="Times New Roman, serif"><span lang="en-US">123”</span></font>大于数字“<font face="Times New Roman, serif"><span lang="en-US">18”</span></font>。</p></li>
        </ol>
        <h3>3.9 列的颜色</h3>
        <p><font face="Times New Roman, serif"><span lang="en-US"> </span></font>列的颜色主要用于数据图。</p>
        <p><font face="Times New Roman, serif"><span lang="en-US"> </span></font>当数据图初始生成时，与列相关的图元素显示为列的颜色。其后用户可以设置为随机颜色。</p>
        <h2>4. 编辑数据</h2>
        <h3>4.1 表格编辑模式</h3>
        <p style="margin-bottom: 0cm"><font face="Times New Roman, serif"><span lang="en-US"> </span></font>表格<span lang="zh-CN">是</span>主编辑模式：</p>
        <ol>
            <ol>
                <li><p style="margin-bottom: 0cm">它的修改被自动应用其它面板。</p></li>
                <li><p style="margin-bottom: 0cm">它是用于保存的最终数据。</p></li>
                <li><p style="margin-bottom: 0cm">除了文本文件，对于字符串类型的数据，支持编辑和保存多行：</p></li>
            </ol>
        </ol>
        <ul>
            <ul>
                <ul>
                    <ul>
                        <li><p style="margin-bottom: 0cm">若值是单行的（不包含换行符）：</p>
                            <ul>
                                <li><p style="margin-bottom: 0cm">点击数据单元时显示单行输入框。</p></li>
                                <li><p style="margin-bottom: 0cm">在值中写入<font face="Times New Roman, serif"><span lang="en-US">"\n" </span></font>作为换行符、然后提交修改（回车或点击其它地方）。</p></li>
                            </ul></li>
                        <li><p style="margin-bottom: 0cm">若值中包含换行符：</p>
                            <ul>
                                <li><p style="margin-bottom: 0cm">点击数据单元时显示多行输入框。</p></li>
                                <li><p style="margin-bottom: 0cm">直接编辑多行文本。</p></li>
                            </ul></li>
                    </ul>
                </ul>
            </ul>
        </ul>
        <h3>4.2 CSV编辑模式</h3>
        <p style="margin-bottom: 0cm"><font face="Times New Roman, serif"><span lang="en-US"> CSV</span></font>是辅编辑模式：</p>
        <ol>
            <ol>
                <li><p style="margin-bottom: 0cm">点击按钮“确定”以把它的修改应用于“表格”。</p></li>
                <li><p style="margin-bottom: 0cm">点击按钮“取消”以丢弃它的修改并从“表格”读取数据。</p></li>
                <li><p style="margin-bottom: 0cm">点击按钮“分隔符”以从“表格”读取数据并应用新的分隔符，<span lang="zh-CN">当前</span>修改被丢弃。</p></li>
                <li><p style="margin-bottom: 0cm">若数值包含分隔符或换行符，则数值应被引号包围起来。</p></li>
            </ol>
        </ol>
        <h3>4.3 保存与恢复</h3>
        <ol>
            <li value="1"><p style="margin-bottom: 0cm">修改<span lang="zh-CN">未保存</span>时，页签头显示<font face="Times New Roman, serif"><span lang="en-US">* </span></font>。</p></li>
            <li><p style="margin-bottom: 0cm">点击按钮“保存”以把修改写入文件和数据库：</p></li>
        </ol>
        <ul>
            <ul>
                <li><p style="margin-bottom: 0cm">“表格”中行的变化，包括修改<font face="Times New Roman, serif"><span lang="en-US">/</span></font>添加<font face="Times New Roman, serif"><span lang="en-US">/</span></font>删除<font face="Times New Roman, serif"><span lang="en-US">/</span></font>排序，影响当前页的行。</p></li>
                <li><p style="margin-bottom: 0cm">“列”页签中的变化，包括修改<font face="Times New Roman, serif"><span lang="en-US">/</span></font>添加<font face="Times New Roman, serif"><span lang="en-US">/</span></font>删除<font face="Times New Roman, serif"><span lang="en-US">/</span></font>排序，影响所有行。</p></li>
                <li><p style="margin-bottom: 0cm">“属性<font face="Times New Roman, serif"><span lang="en-US">/</span></font>列的修改被保存到数据库中。</p></li>
            </ul>
        </ul>
        <ol start="3">
            <li><p style="margin-bottom: 0cm">点击按钮“恢复”以丢弃所有修改并从文件和数据库中加载数据。</p></li>
        </ol>
        <hr>
        <p>更详细的说明见<a href="https://mara-mybox.sourceforge.io/guide/MyBox-DataTools-zh.pdf">《用户手册-数据工具》</a></p>
        </br>
    </body>
</html>